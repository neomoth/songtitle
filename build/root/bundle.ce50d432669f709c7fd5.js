(()=>{const e=document.cookie.includes("accessToken");e||(document.getElementById("loginModal").style.display="flex"),console.log(e);const t=document.getElementById("songTitle"),o=document.getElementById("songArtist"),s=document.getElementById("progress"),n=document.getElementById("status"),l=document.getElementById("cover"),a=document.getElementById("progressBack");let i={hideOnPause:!1,useLocalhost:!1,doFadeOut:!1,doDropShadow:!1};document.getElementById("loginButton").addEventListener("click",(()=>{const e=`https://accounts.spotify.com/authorize?client_id=198a9772670340b198435b615c0f3e19&response_type=code&redirect_uri=${encodeURIComponent(i.useLocalHost?"http://localhost:7934/oauth":"https://song.moth.li/oauth")}&scope=${encodeURIComponent("user-read-currently-playing user-read-playback-state")}`;window.location.href=e}));let c=!0;function r(e,t){t.offsetWidth,e.offsetWidth,e.style.transform="translateX(0)",c=!0;let o,s=0,n=0,l=!0,a=[];setTimeout((()=>{l=!1}),1e3),requestAnimationFrame((function i(r){s||(s=r),o||(o=r);const d=r-s;if(s=r,!l&&c&&(n-=.1*d,e.getBoundingClientRect().right<=t.getBoundingClientRect().right&&!l&&c&&(l=!0,a.push(setTimeout((()=>{n=0,a.push(setTimeout((()=>{l=!1,o=r}),1e3))}),1e3))),e.style.transform=`translateX(${n}px)`),c)requestAnimationFrame(i);else for(let e in a)clearTimeout(e)}))}function d(){fetch("/api/nowplaying").then((e=>e.json())).then((e=>{if(e.song&&e.artist){const a=e.progress/e.duration*100,c=t.innerText,d=o.innerText;if(i.hideOnPause&&(document.querySelector(".now-playing").style.cssText=e.playing?"":"display:none;"),t.innerText=e.song,o.innerText=e.artist,o.style.display="",n.src=e.playing?"/assets/play.svg":"/assets/pause.svg",console.log(e.cover),console.log(null!=e.cover),l.src=null!=e.cover?e.cover:"/assets/weestspin.gif",s.style.width=`${a}%`,document.getElementById("songTitle").classList.add("scrolling-text"),t.innerText!=c){t.style.width="auto";const e=document.getElementById("songContainer");t.offsetWidth>e.offsetWidth&&(r(t,e),i.doDropShadow&&(t.style.width=`${t.offsetWidth+5}px`),i.doFadeOut&&(t.style.width=`${t.offsetWidth+32}px`))}if(o.innerText!=d){o.style.width="auto";const e=document.getElementById("artistContainer");o.offsetWidth>e.offsetWidth&&(r(o,e),i.doDropShadow&&(o.style.width=`${o.offsetWidth+5}px`),i.doFadeOut&&(o.style.width=`${o.offsetWidth+32}px`))}}else progress.style.width="0",n.src="/assets/error.svg",t.innerText="No song currently playing.",t.classList.remove("scrolling-text"),l.src="/assets/weestspin.gif",i.hideOnPause&&(document.querySelector(".now-playing").style.display="none"),c=!1,document.getElementById("songTitle").style.transform="translateX(0)",document.getElementById("songArtist").style.transform="translateX(0)",t.style.animation="",o.style.animation="",o.innerText="",o.style.display="none"})).catch((e=>{console.error("Failed fetching now playing:",e)}))}function p(){fetch("/api/refreshtoken").then((e=>e.json())).then((e=>{e.success?console.log("Refreshed token."):console.error("Failed to refresh token. Please log in again.")}))}setInterval(d,5e3),d(),setInterval(p,18e5),p();const g=new URLSearchParams(window.location.search);if("false"==g.get("showcover")&&(document.getElementById("cover").style.display="none",document.querySelector(".now-playing .top").style.gap="0"),"false"==g.get("showplayback")&&(document.getElementById("status").style.display="none",document.getElementById("progress").style.display="none",document.querySelector(".progress-back").style.display="none"),"false"==g.get("showstatus")&&(document.getElementById("status").style.display="none",document.querySelector(".now-playing .bottom").style.gap="0"),"true"==g.get("hideonpause")&&(i.hideOnPause=!0),"true"==g.get("uselocalhost")&&(i.useLocalHost=!0),"true"==g.get("dofadeout")&&(console.log("penis"),i.doFadeOut=!0,document.querySelector(".now-playing .top").style.cssText+="mask-image:linear-gradient(90deg, #000 88%, transparent);"),"true"==g.get("dropshadow")&&(i.doDropShadow=!0,t.style.textShadow="2px 2px 4px black, -2px -2px 4px black, 2px -2px 4px black, -2px 2px 4px black",t.style.paddingLeft="3px",o.style.textShadow="2px 2px 4px black, -2px -2px 4px black, 2px -2px 4px black, -2px 2px 4px black",o.style.paddingLeft="3px",a.style.filter="drop-shadow(2px 2px 2px black)",n.style.filter="drop-shadow(2px 2px 2px white) invert(100%)",l.style.filter="drop-shadow(2px 2px 2px black)"),g.has("clearcookies")&&(document.cookie='accessToken=""',document.cookie='refreshToken=""',window.location.refresh()),g.has("cssprops")){const e=g.get("cssprops");for(let t of e.split(";")){console.log(t);let e=t.split(":")[0],o=t.split(":")[1];console.log(e),console.log(o),document.body.style.cssText+=`--${e}:${o};`}}let u;!function e(){const t="https:"==location.protocol?"wss":"ws",o=location.port?":7395":"/ws";u=new WebSocket(`${t}://${window.location.hostname}${o}`),u.onopen=()=>{console.log("connected to websocket"),u.send(JSON.stringify({protocol:"SET_IDENTIFIER",data:g.has("identifier")?g.get("identifier"):void 0}))},u.onmessage=e=>{console.log(e.data)},u.onclose=()=>{setTimeout(e,1e3)},u.onerror=e=>{console.error(e)}}()})();